version: "3.7"
services:
  e-commerce-gateway-service:
    depends_on:
      - product-price-service
      - product-seller-service
      - product-service
    image: 337901474843.dkr.ecr.us-east-1.amazonaws.com/e-commerce-gateway-service:e-commerce-gateway-service-latest   
    # restart: always
    restart: on-failure
    ports:
      - 9080:9080
    environment:
      price_url: http://product-price-service:9082/productPrice/product
      seller_url: http://product-seller-service:9083/productSeller/product
      product_url: http://product-service:9081/products
    networks:
      - e-commerce-network

  product-price-service:
    depends_on:
      - emp-app-db
    image: 337901474843.dkr.ecr.us-east-1.amazonaws.com/product-price-service:product-price-service-latest

    ports:
      - 9082:9082
    networks:
      - e-commerce-network
    restart: on-failure

  product-seller-service:
    image: 337901474843.dkr.ecr.us-east-1.amazonaws.com/product-seller-service:product-seller-service-latest
    ports:
      - 9083:9083
    networks:
      - e-commerce-network
    restart: on-failure      

  product-service:
    image: 337901474843.dkr.ecr.us-east-1.amazonaws.com/product-service:product-service-latest
    restart: on-failure
    ports:
      - 9081:9081
    networks:
      - e-commerce-network

  e-commerce-ang-ui-service:
    depends_on:
      - e-commerce-gateway-service
    image: 337901474843.dkr.ecr.us-east-1.amazonaws.com/e-commerce-ang:latest
    environment:
      price_api_url: http://e-commerce-gateway-service:9080/price
      seller_api_url: http://e-commerce-gateway-service:9080/seller
      product_api_url: http://e-commerce-gateway-service:9080/products
    ports:
      - 4200:80
    networks:
      - e-commerce-network
    restart: on-failure      

networks:
  e-commerce-network:
    driver: bridge